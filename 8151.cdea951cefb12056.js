"use strict";(self.webpackChunkintswap_frontend=self.webpackChunkintswap_frontend||[]).push([[8151],{38151:(R,m,s)=>{s.r(m),s.d(m,{ProposalDialogComponent:()=>T,ProposalDialogModule:()=>Z});var d=s(88692),O=s(9638),_=s(88696),y=s(83331),l=s(2024),o=s(92673),b=s(87668),x=s(54121),n=s(41781),f=s(9375),h=s(23815),t=s(64537),M=s(96195);function C(i,p){if(1&i&&(t.ynx(0),t.TgZ(1,"div",3),t._uU(2),t.qZA(),t.TgZ(3,"div",4),t._uU(4),t.qZA(),t.BQk()),2&i){const a=p.ngIf;t.xp6(2),t.Oqu(a.label),t.xp6(2),t.hij("",a.value," ")}}function D(i,p){if(1&i&&(t.ynx(0),t.TgZ(1,"span",2),t._uU(2,"Charts"),t.qZA(),t.TgZ(3,"div",11)(4,"h3"),t._uU(5,"Price/Amount"),t.qZA(),t._UZ(6,"div",12),t.qZA(),t.TgZ(7,"div",11)(8,"h3"),t._uU(9,"Liquidity"),t.qZA(),t._UZ(10,"div",13),t.qZA(),t.BQk()),2&i){const a=t.oxw();t.xp6(6),t.Q6J("options",a.chartOption1)("loading",!a.pair),t.xp6(4),t.Q6J("options",a.chartOption2)("loading",!a.pair)}}function A(i,p){1&i&&(t.TgZ(0,"div",14),t._uU(1,"Created"),t.qZA())}function U(i,p){1&i&&(t.TgZ(0,"div",15),t._uU(1,"Executed"),t.qZA())}function E(i,p){1&i&&(t.TgZ(0,"div",16),t._uU(1,"Abort"),t.qZA())}function S(i,p){if(1&i){const a=t.EpF();t.TgZ(0,"div",17),t.NdJ("click",function(){t.CHM(a);const r=t.oxw();return t.KtG(r.excuteProposal())}),t._uU(1,"Executable"),t.qZA()}}let T=(()=>{class i{constructor(a,e){this.dialogRef=a,this.web3Service=e,this.proposalData$=new x.X({label:"",value:""}),this.chartOption1={tooltip:{trigger:"axis",position:function(r){return{top:"10%",right:"5%"}},valueFormatter:r=>parseFloat(r).toFixed(4)+" "+this.pair?.token.symbol},grid:{left:"15%",right:"5%",bottom:"15%",top:"5%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,min:0,axisLabel:{show:!1,formatter:r=>parseFloat(r).toFixed(4)+" "+this.pair?.token.symbol},axisTick:{show:!1},data:[]},yAxis:{type:"value",min:0,axisLabel:{show:!1},axisTick:{show:!1},axisLine:{show:!0},splitLine:{show:!1}},legend:{},dataZoom:[{type:"inside",start:0,end:100},{type:"slider",show:!0,bottom:0,height:20,start:0,end:100,backgroundColor:"rgba(255,255,255,0.1)",fillerColor:"rgba(255,255,255,0)",borderColor:"#FFEAF5",borderRadius:4,brushStyle:{color:"rgba(255,255,255,0)"},selectedDataBackground:{lineStyle:{color:"#ffb6db"},areaStyle:{color:new f.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#ffb6db"},{offset:1,color:"#f9d4af"}])}},handleSize:15,brushSelect:!1,dataBackground:{lineStyle:{color:"#fff5f0"},areaStyle:{color:new f.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#fff5f0"},{offset:1,color:"#ffffff"}])}}}],series:[{name:"prev Price",type:"line",symbol:"none",itemStyle:{color:"#ffb6db"},areaStyle:{color:new f.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(255,182,219,0.3)"},{offset:.8,color:"rgba(249,212,175,0.1)"},{offset:1,color:"rgba(255,255,255,0)"}])},data:[]},{name:"new Price",type:"line",symbol:"none",itemStyle:{color:"#00B6FF"},areaStyle:{color:new f.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#00FFF1"},{offset:.8,color:"rgba(180,233,255,0.1)"},{offset:1,color:"rgba(255,255,255,0)"}])},data:[]}]},this.chartOption2={tooltip:{trigger:"axis",position:function(r){return{top:"10%",right:"5%"}},valueFormatter:r=>parseFloat(r).toFixed(4)+" "},grid:{left:"5%",right:"5%",bottom:"2%",top:"5%",containLabel:!0},xAxis:{type:"category",min:0,boundaryGap:!1,axisLabel:{show:!0},axisTick:{show:!0}},yAxis:{type:"value",axisLabel:{show:!1},axisTick:{show:!1},axisLine:{show:!0},splitLine:{show:!1}},legend:{},series:[{name:"prev Liquidity",type:"line",symbol:"none",itemStyle:{color:"#ffb6db"},areaStyle:{color:new f.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(255,182,219,0.3)"},{offset:1,color:"rgba(249,212,175,0.8)"}])},data:[]},{name:"new Liquidity",type:"line",symbol:"none",itemStyle:{color:"#00B6FF"},areaStyle:{color:new f.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#00FFF1"},{offset:1,color:"rgba(180,233,255,0.8)"}])},data:[]}]}}ngOnInit(){this.buildProposalData()}parseInt(a){return parseInt(a)}isExecutable(a){return 1e3*(parseInt(a.startTime)+parseInt(a.delay))<=(new Date).getTime()}getStatus(a){const e=this.isExecutable(a);return 0==a.status?e?3:0:a.status}buildProposalData(){switch(this.proposal.type){case 0:const a=l.O$.from(JSON.parse(this.proposal.data).newMinSqrtPrice).pow(2).div(n.yb).toString();this.getPriceRangeWithMinPrice(a).then(({maxPrice:r,newLiquidity:c})=>{this.proposalData$.next({label:"New Price Range",value:`${(0,o.formatUnits)(a,"18")} - ${(0,o.formatUnits)(r,"18")}`}),this.calcCurrentPriceData(),this.calcNewPriceData(c,r,a)});break;case 1:const e=l.O$.from(JSON.parse(this.proposal.data).newMaxSqrtPrice).pow(2).div(n.yb).toString();this.getPriceRangeWithMaxPrice(e).then(({minPrice:r,newLiquidity:c})=>{this.proposalData$.next({label:"New Price Range",value:`${(0,o.formatUnits)(r,"18")} - ${(0,o.formatUnits)(e,"18")}`}),this.calcCurrentPriceData(),this.calcNewPriceData(c,e,r)});break;case 2:this.proposalData$.next({label:"New Royalty Rayio :",value:`${(0,o.formatUnits)(JSON.parse(this.proposal.data).newRoyaltyRatio,"16")} %`});break;case 3:this.proposalData$.next({label:"New Withdraw Royalty Amount",value:`${(0,o.formatUnits)(JSON.parse(this.proposal.data).newWithdrawRoyaltyAmount,"18")} ${this.pair.token.symbol}`});break;case 4:this.proposalData$.next({label:"New Royalty Reward Ratio",value:`${(0,o.formatUnits)(JSON.parse(this.proposal.data).newRoyaltyRewardRatio,"16")} %`})}}getPriceRangeWithMaxPrice(a){return this.web3Service.invokeContract("IntswapV1Pair","getNewPriceRangeWithMaxSqrtPrice",[(0,n._b)(l.O$.from(a).mul(n.yb)).toString()],this.pair.address).then(e=>({minPrice:l.O$.from(e[1]).pow(2).div(n.yb).toString(),newLiquidity:e[0]}))}getPriceRangeWithMinPrice(a){return this.web3Service.invokeContract("IntswapV1Pair","getNewPriceRangeWithMinSqrtPrice",[(0,n._b)(l.O$.from(a).mul(n.yb)).toString()],this.pair.address).then(e=>({maxPrice:l.O$.from(e[1]).pow(2).div(n.yb).toString(),newLiquidity:e[0]}))}excuteProposal(){this.dialogRef.close(this.proposal)}calcCurrentPriceData(){if(this.pair){const a=new Array(2*parseInt((0,o.formatUnits)(this.pair.nftAmount,"18"))).fill(0).map((c,g)=>this.pair?(0,o.formatUnits)(l.O$.from(this.pair.virtualLiquidity).pow(2).mul(n.yb).div(l.O$.from(g+1).mul(n.yb).add(l.O$.from(this.pair.virtualLiquidity).mul(n.yb).div((0,n._b)(l.O$.from(this.pair.maxPrice).mul(n.yb)))).pow(2)).toString(),"18"):"0.0000");this.chartOption1=(0,h.cloneDeep)(this.chartOption1),this.chartOption1.xAxis.data=new Array(2*parseInt((0,o.formatUnits)(this.pair?.nftAmount||0,"18"))).fill(0).map((c,g)=>g+1),this.chartOption1.series[0].data=a,this.chartOption1.series[0].markPoint={symbol:"circle",symbolSize:6,data:[{coord:[parseInt((0,o.formatUnits)(this.pair.nftAmount,"18"))+"",(0,o.formatUnits)(this.pair.price,"18").toString()]}]},this.chartOption1.series[0].markLine={lineStyle:{color:"rgba(255,182,219,0.8)"},symbol:["none","none"],data:[{yAxis:(0,o.formatUnits)(this.pair.price,"18").toString()}],label:{color:"rgba(255,182,219,0.8)",position:"start",formatter:(c,g)=>Math.floor(100*parseFloat(c.value))/100+""}},this.chartOption2=(0,h.cloneDeep)(this.chartOption2);const e=(0,o.formatUnits)(this.pair.maxPrice,"18"),r=(0,o.formatUnits)(this.pair.minPrice,"18");this.chartOption2.xAxis.data=[r,e],this.chartOption2.series[0].data=[[r,(0,o.formatUnits)(this.pair.virtualLiquidity,"18")],[e,(0,o.formatUnits)(this.pair.virtualLiquidity,"18")]]}}calcNewPriceData(a,e,r){if(this.pair){const c=new Array(2*parseInt((0,o.formatUnits)(this.pair.nftAmount,"18"))).fill(0).map((w,u)=>this.pair?(0,o.formatUnits)(l.O$.from(a).pow(2).mul(n.yb).div(l.O$.from(u+1).mul(n.yb).add(l.O$.from(a).mul(n.yb).div((0,n._b)(l.O$.from(e).mul(n.yb)))).pow(2)).toString(),"18"):"0.0000");this.chartOption1=(0,h.cloneDeep)(this.chartOption1),this.chartOption1.series[1].data=c,this.chartOption2=(0,h.cloneDeep)(this.chartOption2);const g=(0,o.formatUnits)(this.pair.maxPrice,"18"),L=(0,o.formatUnits)(this.pair.minPrice,"18"),P=(0,o.formatUnits)(e,"18"),v=(0,o.formatUnits)(r,"18");this.chartOption2.xAxis.data=[v,P,g,L].sort((w,u)=>parseFloat(w)-parseFloat(u)),this.chartOption2.series[1].data=[[v,(0,o.formatUnits)(a,"18")],[P,(0,o.formatUnits)(a,"18")]]}}}return i.\u0275fac=function(a){return new(a||i)(t.Y36(_.so),t.Y36(M.U))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-proposal-dialog"]],decls:31,vars:19,consts:[[1,"dialog-wrapper"],[1,"review-step"],[2,"color","#fff","background","rgb(255, 211, 227)","margin-bottom","0","font-weight","bolder","padding","0 12px","grid-column-start","span 4","width","100%"],[1,"review-label"],[1,"review-value"],[4,"ngIf"],[1,"status-wrapper",3,"ngSwitch"],["class","status created",4,"ngSwitchCase"],["class","status executed",4,"ngSwitchCase"],["class","status abort",4,"ngSwitchCase"],["class","status executable",3,"click",4,"ngSwitchCase"],[1,"chart"],["echarts","",1,"price-volume-chart",3,"options","loading"],["echarts","",1,"liquidity-price-chart",3,"options","loading"],[1,"status","created"],[1,"status","executed"],[1,"status","abort"],[1,"status","executable",3,"click"]],template:function(a,e){1&a&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),t._uU(3,"PROPOSAL"),t.qZA(),t.TgZ(4,"h2"),t._uU(5),t.qZA(),t.TgZ(6,"span",2),t._uU(7,"Detail"),t.qZA(),t.TgZ(8,"div",3),t._uU(9,"Application Date :"),t.qZA(),t.TgZ(10,"div",4),t._uU(11),t.ALo(12,"date"),t.qZA(),t.TgZ(13,"div",3),t._uU(14,"Effective Date :"),t.qZA(),t.TgZ(15,"div",4),t._uU(16),t.ALo(17,"date"),t.qZA(),t.YNc(18,C,5,2,"ng-container",5),t.ALo(19,"async"),t.TgZ(20,"div",3),t._uU(21,"Description :"),t.qZA(),t.TgZ(22,"div",4)(23,"p"),t._uU(24),t.qZA()(),t.YNc(25,D,11,4,"ng-container",5),t.qZA(),t.TgZ(26,"div",6),t.YNc(27,A,2,0,"div",7),t.YNc(28,U,2,0,"div",8),t.YNc(29,E,2,0,"div",9),t.YNc(30,S,2,0,"div",10),t.qZA()()),2&a&&(t.xp6(5),t.Oqu(e.proposal.title),t.xp6(6),t.Oqu(t.xi3(12,11,1e3*e.parseInt(e.proposal.startTime),"y-M-dd HH:mm:ss")),t.xp6(5),t.hij(" ",t.xi3(17,14,1e3*(e.parseInt(e.proposal.startTime)+e.parseInt(e.proposal.delay)),"y-M-dd HH:mm:ss")," "),t.xp6(2),t.Q6J("ngIf",t.lcZ(19,17,e.proposalData$)),t.xp6(6),t.Oqu(e.proposal.desc||"no description."),t.xp6(1),t.Q6J("ngIf",(0==e.proposal.type||1==e.proposal.type)&&1!=e.proposal.status&&2!=e.proposal.status),t.xp6(1),t.Q6J("ngSwitch",e.getStatus(e.proposal)),t.xp6(1),t.Q6J("ngSwitchCase",0),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3))},dependencies:[d.O5,d.RF,d.n9,b._w,d.Ov,d.uU],styles:[".dialog-wrapper[_ngcontent-%COMP%]{width:30vw;height:80vh;overflow:hidden;padding:2rem 1rem 3rem 2rem;background:linear-gradient(135deg,#feedff 0%,#fff 10%,#fff 90%,#fff4e6 100%);border-radius:16px;border:1px solid rgba(228,178,201,.24);box-sizing:border-box;position:relative}.review-step[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;padding-right:.6rem;overflow-y:scroll;overflow-x:hidden;box-sizing:border-box;display:grid;grid-template-columns:auto 1fr 1fr 1fr;justify-items:center;align-items:center;row-gap:12px;column-gap:12px}.review-step[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{grid-column-start:span 4;text-align:left;font-size:24px;font-weight:bolder;justify-self:start}.review-step[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column-start:span 4;text-align:left;font-weight:bolder;justify-self:start}.review-step[_ngcontent-%COMP%]   .review-label[_ngcontent-%COMP%]{width:100%;text-align:left;font-weight:700;align-self:start}.review-step[_ngcontent-%COMP%]   .review-value[_ngcontent-%COMP%]{grid-column-start:span 3;justify-self:start;align-self:start;width:80%;word-break:break-word}.review-step[_ngcontent-%COMP%]   .step-btn[_ngcontent-%COMP%]{grid-column-start:span 2}.review-step[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]{grid-column-start:span 4;padding:0 0 12px;width:100%}.review-step[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]   .liquidity-price-chart[_ngcontent-%COMP%], .review-step[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]   .price-volume-chart[_ngcontent-%COMP%]{width:100%;height:30vh}.status-wrapper[_ngcontent-%COMP%]{position:absolute;bottom:.5rem;width:calc(30vw - 4rem);display:flex;flex-direction:row;justify-content:center;align-items:center}.status[_ngcontent-%COMP%]{color:#fff;font-weight:700;padding:0 12px;border-radius:16px;font-size:18px;display:flex;flex-direction:row;justify-content:center;align-items:center}.executable[_ngcontent-%COMP%]{background:rgb(136,85,255);cursor:pointer}.created[_ngcontent-%COMP%]{background:rgb(78,230,202)}.executed[_ngcontent-%COMP%]{background:rgb(94,219,236)}.abort[_ngcontent-%COMP%]{background:rgb(255,105,105)}"]}),i})(),Z=(()=>{class i{}return i.\u0275fac=function(a){return new(a||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[d.ez,y.Ps,O.ot,_.Is,b.Ns.forChild()]}),i})()}}]);