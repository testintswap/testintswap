"use strict";(self.webpackChunkintswap_frontend=self.webpackChunkintswap_frontend||[]).push([[1227],{11227:(it,S,p)=>{p.r(S),p.d(S,{LpStakingPoolsModule:()=>nt});var u=p(88692),h=p(7976),P=p(8239),c=p(2024),Z=p(92673),k=p(54121),y=p(42147),m=p(27969),f=p(61528),$=p(84967),M=p(15696),x=p(66393),C=p(84945),U=p(62686),t=p(64537),I=p(19376),w=p(96195),B=p(39869),L=p(83331),A=p(50132);function Y(o,e){1&o&&(t.TgZ(0,"mat-icon",13),t._uU(1," south"),t.qZA())}function N(o,e){1&o&&(t.TgZ(0,"mat-icon",13),t._uU(1," north"),t.qZA())}function J(o,e){if(1&o&&(t.ynx(0),t.YNc(1,Y,2,0,"mat-icon",12),t.YNc(2,N,2,0,"mat-icon",12),t.BQk()),2&o){const n=t.oxw().ngIf;t.xp6(1),t.Q6J("ngIf",-1==n.sortBy.sortByTVL),t.xp6(1),t.Q6J("ngIf",1==n.sortBy.sortByTVL)}}function Q(o,e){1&o&&(t.TgZ(0,"mat-icon",13),t._uU(1," south"),t.qZA())}function R(o,e){1&o&&(t.TgZ(0,"mat-icon",13),t._uU(1," north"),t.qZA())}function z(o,e){if(1&o&&(t.ynx(0),t.YNc(1,Q,2,0,"mat-icon",12),t.YNc(2,R,2,0,"mat-icon",12),t.BQk()),2&o){const n=t.oxw().ngIf;t.xp6(1),t.Q6J("ngIf",-1==n.sortBy.sortByAPY),t.xp6(1),t.Q6J("ngIf",1==n.sortBy.sortByAPY)}}function F(o,e){1&o&&(t.TgZ(0,"div",14),t._uU(1,"loading..."),t.qZA())}function b(o,e){1&o&&(t.TgZ(0,"div",14),t._uU(1,"No Data."),t.qZA())}function j(o,e){if(1&o&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&o){const n=e.ngIf;t.xp6(1),t.AsE(" ",n.name," : ",n.apy," % ")}}function D(o,e){1&o&&t._uU(0," loadingItem... ")}function V(o,e){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,j,2,2,"div",21),t.ALo(2,"async"),t.YNc(3,D,1,0,"ng-template",null,24,t.W1O),t.qZA()),2&o){const n=e.$implicit,l=t.MAs(4);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,n))("ngIfElse",l)}}function q(o,e){if(1&o&&(t.ynx(0),t.YNc(1,V,5,4,"div",23),t.BQk()),2&o){const n=e.ngIf;t.xp6(1),t.Q6J("ngForOf",n)}}function E(o,e){1&o&&t._uU(0," loading ")}function G(o,e){if(1&o&&(t.TgZ(0,"div",20),t.YNc(1,q,2,1,"ng-container",21),t.ALo(2,"async"),t.YNc(3,E,1,0,"ng-template",null,22,t.W1O),t.qZA()),2&o){const n=t.MAs(4),l=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,l.strategyApys$))("ngIfElse",n)}}const H=function(o){return["/","app","lp-staking-pool",o]};function W(o,e){if(1&o&&(t.TgZ(0,"div",15)(1,"div",4),t._uU(2),t.qZA(),t.TgZ(3,"div",16),t._uU(4),t.ALo(5,"number"),t.ALo(6,"async"),t.qZA(),t.TgZ(7,"div",17),t._uU(8),t.ALo(9,"number"),t.ALo(10,"async"),t.TgZ(11,"mat-icon",18),t._uU(12,"help "),t.qZA()(),t.TgZ(13,"div",8),t._uU(14),t.qZA(),t.TgZ(15,"div",9),t._uU(16),t.ALo(17,"async"),t.qZA(),t.YNc(18,G,5,4,"ng-template",null,19,t.W1O),t.qZA()),2&o){const n=e.$implicit,l=t.MAs(19);t.Q6J("routerLink",t.VKq(20,H,n.pairAddress)),t.xp6(2),t.Oqu(n.pairName),t.xp6(2),t.hij("$ ",t.xi3(5,8,n.tvl||t.lcZ(6,11,n.tvl$)||0,"1.2-2"),""),t.xp6(4),t.hij("",t.xi3(9,13,n.totalApy||t.lcZ(10,16,n.totalApy$)||0,"1.2-2")," % "),t.xp6(3),t.Q6J("nzPopoverArrowPointAtCenter",!0)("nzPopoverContent",l),t.xp6(3),t.hij("",n.stakedRatio," %"),t.xp6(2),t.hij("$ ",t.lcZ(17,18,n.userStaked$),"")}}function K(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),t._uU(4,"NAME"),t.qZA(),t.TgZ(5,"div",5),t.NdJ("click",function(){const s=t.CHM(n).ngIf,r=t.oxw();return t.KtG(r.changeSortDirection(-1,1,s.sortBy))}),t._uU(6,"TVL "),t.YNc(7,J,3,2,"ng-container",6),t.qZA(),t.TgZ(8,"div",7),t.NdJ("click",function(){const s=t.CHM(n).ngIf,r=t.oxw();return t.KtG(r.changeSortDirection(1,-1,s.sortBy))}),t._uU(9,"Total APY "),t.YNc(10,z,3,2,"ng-container",6),t.qZA(),t.TgZ(11,"div",8),t._uU(12,"Total Staked Ratio"),t.qZA(),t.TgZ(13,"div",9),t._uU(14,"Your Staked"),t.qZA()(),t.YNc(15,F,2,0,"div",10),t.YNc(16,b,2,0,"div",10),t.YNc(17,W,20,22,"div",11),t.qZA()()}if(2&o){const n=e.ngIf;t.xp6(7),t.Q6J("ngIf",n.sortBy),t.xp6(3),t.Q6J("ngIf",n.sortBy),t.xp6(5),t.Q6J("ngIf",!n.lpStakingPoolList),t.xp6(1),t.Q6J("ngIf",!!n.lpStakingPoolList&&0==n.lpStakingPoolList.length),t.xp6(1),t.Q6J("ngForOf",n.lpStakingPoolList)}}const X=function(o,e){return{lpStakingPoolList:o,sortBy:e}},tt=[{path:"",component:(()=>{class o{constructor(n,l,a){var s=this;this.cacheService=n,this.web3Service=l,this.graphqlService=a,this.sortBy$=new k.X({sortByTVL:-1,sortByAPY:-1}),this.showOnlyUserStaked$=new k.X(!1),this.lpStakingPoolList$=this.cacheService.pairList$.pipe((0,y.x)((r,i)=>r.length==i.length),(0,m.U)(r=>r.map(i=>{const g=c.O$.from(i.lpStakingPool.totalStakingAmount).mul(c.O$.from("10000")).div(c.O$.from(i.liquidity)).toNumber()/100,_=this.cacheService.ethPrice$.pipe((0,m.U)(d=>c.O$.from(d).mul(c.O$.from(i.tvl)).mul(c.O$.from(parseInt(100*g+""))).div(c.O$.from("10").pow(30)).toString())),O=_.pipe((0,f.w)(function(){var d=(0,P.Z)(function*(v){return yield s.getApy0fStrategies(i,v)});return function(v){return d.apply(this,arguments)}}())),et=O.pipe((0,f.w)(d=>(0,$.D)(d))).pipe((0,m.U)(d=>this.sumApy(d)),(0,y.x)((d,v)=>d==v)),T=!!i.lpStakingPool.userStaking&&i.lpStakingPool.userStaking.length>0&&c.O$.from(i.lpStakingPool.userStaking[0].amount).gt(c.O$.from("0"));return{pairAddress:i.address,pairName:i.collection.symbol+" - "+i.token.symbol,totalApy$:et,stakedRatio:g,tvl$:_,strategyApys$:O,isUserStaked:T,userStaked$:_.pipe((0,m.U)(d=>T?c.O$.from(i.lpStakingPool.userStaking[0].amount).mul(c.O$.from(d).div(c.O$.from(i.lpStakingPool.totalStakingAmount))).toString():"0"))}}))),this.filterLpStakingPoolList$=this.showOnlyUserStaked$.pipe((0,f.w)(r=>this.lpStakingPoolList$.pipe((0,m.U)(i=>i.filter(g=>!r||g.isUserStaked))))),this.sortLpStakingPoolList$=this.filterLpStakingPoolList$.pipe((0,f.w)(r=>this.sortList(r)))}ngOnInit(){}sortList(n){if(n){const l=n.map(a=>a.totalApy$.pipe((0,m.U)(s=>({...a,totalApy:s}))).pipe((0,f.w)(s=>s.tvl$.pipe((0,m.U)(r=>({...s,tvl:r}))))));return this.sortBy$.pipe((0,f.w)(({sortByAPY:a,sortByTVL:s})=>(0,M.a)(l).pipe((0,m.U)(r=>r.sort((i,g)=>a*(i.totalApy-g.totalApy)).sort((i,g)=>s*(parseFloat(i.tvl)>parseFloat(g.tvl)?1:-1))))))}return(0,x.D)([])}sumApy(n){let l=0;for(let a=0;a<n.length;a++)l+=n[a].apy;return l}changeSortDirection(n,l,a){a&&this.sortBy$.next({sortByAPY:a.sortByAPY*l,sortByTVL:a.sortByTVL*n})}getGlobalStrategies(){return this.graphqlService.getGlobalStrategies().then(n=>n.data.globalIncentiveStrategies)}getApy0fStrategies(n,l){var a=this;return(0,P.Z)(function*(){return[...yield a.getGlobalStrategies(),...n.lpStakingPool.incentiveStrategyList].map(s=>{if(s.status){const r=a.getStrategyRewardRate(n.address,s.address);return r&&c.O$.from(l).gt(c.O$.from(0))?r.pipe((0,m.U)(i=>({name:s.name,apy:c.O$.from(i).mul(c.O$.from("315360000000")).div(c.O$.from(l)).toNumber()/100})),(0,y.x)((i,g)=>i==g)):(0,C.of)({name:s.name,apy:0})}return(0,C.of)({name:s.name,apy:0})})})()}getStrategyRewardRate(n,l){var a=this;return(0,x.D)(this.web3Service.invokeContract("IIntswapV1IncentiveStrategy","estimatedOneYearRewards",[n],l)).pipe((0,f.w)(function(){var s=(0,P.Z)(function*(r){const i=r[0];if(i==U.je)return"0";const g=r[1],_=(0,Z.parseUnits)(yield a.cacheService.fetchRewardTokenPrice(i),"2");return c.O$.from(g).mul(_).div(c.O$.from("100")).toString()});return function(r){return s.apply(this,arguments)}}()))}}return o.\u0275fac=function(n){return new(n||o)(t.Y36(I.Q),t.Y36(w.U),t.Y36(B.J))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-lp-staking-pools"]],decls:3,vars:8,consts:[["class","lp-pools-wrapper",4,"ngIf"],[1,"lp-pools-wrapper"],[1,"lp-pools-list"],[1,"lp-pool-header"],[1,"lp-pool-name"],[1,"lp-pool-tvl",2,"cursor","pointer",3,"click"],[4,"ngIf"],[1,"lp-pool-total-apy",2,"cursor","pointer",3,"click"],[1,"lp-pool-staked-ratio"],[1,"lp-pool-user-staked"],["class","lp-pool-loading",4,"ngIf"],["class","lp-pool-item",3,"routerLink",4,"ngFor","ngForOf"],["color","primary",4,"ngIf"],["color","primary"],[1,"lp-pool-loading"],[1,"lp-pool-item",3,"routerLink"],[1,"lp-pool-tvl"],[1,"lp-pool-total-apy"],["color","primary","nz-popover","","nzPopoverPlacement","rightTop",3,"nzPopoverArrowPointAtCenter","nzPopoverContent"],["apyDetail",""],[2,"min-height","20vh","min-width","15vw"],[4,"ngIf","ngIfElse"],["loading",""],[4,"ngFor","ngForOf"],["loadingItem",""]],template:function(n,l){1&n&&(t.YNc(0,K,18,5,"div",0),t.ALo(1,"async"),t.ALo(2,"async")),2&n&&t.Q6J("ngIf",t.WLB(5,X,t.lcZ(1,1,l.sortLpStakingPoolList$),t.lcZ(2,3,l.sortBy$)))},dependencies:[u.sg,u.O5,h.rH,L.Hw,A.lU,u.Ov,u.JJ],styles:[".lp-pools-wrapper[_ngcontent-%COMP%]{width:80vw;min-height:40vh;border-radius:16px;background:#fff;margin:1rem auto;padding:12px}.lp-pools-list[_ngcontent-%COMP%]{width:100%}.lp-pool-loading[_ngcontent-%COMP%]{width:100%;margin-bottom:4px;height:40px;display:flex;align-items:center;justify-content:center}.lp-pool-header[_ngcontent-%COMP%], .lp-pool-item[_ngcontent-%COMP%]{width:100%;margin-bottom:4px;height:40px;display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr;font-weight:700}.lp-pool-header[_ngcontent-%COMP%]   .lp-pool-name[_ngcontent-%COMP%], .lp-pool-header[_ngcontent-%COMP%]   .lp-pool-total-apy[_ngcontent-%COMP%], .lp-pool-header[_ngcontent-%COMP%]   .lp-pool-staked-ratio[_ngcontent-%COMP%], .lp-pool-header[_ngcontent-%COMP%]   .lp-pool-user-staked[_ngcontent-%COMP%], .lp-pool-header[_ngcontent-%COMP%]   .lp-pool-tvl[_ngcontent-%COMP%], .lp-pool-item[_ngcontent-%COMP%]   .lp-pool-name[_ngcontent-%COMP%], .lp-pool-item[_ngcontent-%COMP%]   .lp-pool-total-apy[_ngcontent-%COMP%], .lp-pool-item[_ngcontent-%COMP%]   .lp-pool-staked-ratio[_ngcontent-%COMP%], .lp-pool-item[_ngcontent-%COMP%]   .lp-pool-user-staked[_ngcontent-%COMP%], .lp-pool-item[_ngcontent-%COMP%]   .lp-pool-tvl[_ngcontent-%COMP%]{padding:0 12px;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.lp-pool-header[_ngcontent-%COMP%]{font-weight:bolder;height:48px;font-size:18px;border-radius:4px;background:rgb(255,241,248)}.lp-pool-item[_ngcontent-%COMP%]{border-radius:4px;border:1px solid rgba(255,216,237,.4);cursor:pointer}.lp-pool-item[_ngcontent-%COMP%]:hover{background:rgb(249,241,255)}.lp-pool-item[_ngcontent-%COMP%]   .lp-pool-total-apy[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-left:12px;height:18px;width:18px;font-size:18px;cursor:pointer}"]}),o})()}];let ot=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[h.Bz.forChild(tt),h.Bz]}),o})(),nt=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[u.ez,ot,L.Ps,A.$6]}),o})()}}]);