"use strict";(self.webpackChunkintswap_frontend=self.webpackChunkintswap_frontend||[]).push([[8151],{38151:(L,m,s)=>{s.r(m),s.d(m,{ProposalDialogComponent:()=>T,ProposalDialogModule:()=>Z});var d=s(88692),y=s(9638),_=s(88696),O=s(83331),l=s(2024),o=s(92673),b=s(87668),x=s(54121),r=s(41781),f=s(9375),g=s(23815),t=s(64537),M=s(96195);function C(i,c){if(1&i&&(t.ynx(0),t.TgZ(1,"div",3),t._uU(2),t.qZA(),t.TgZ(3,"div",4),t._uU(4),t.qZA(),t.BQk()),2&i){const e=c.ngIf;t.xp6(2),t.Oqu(e.label),t.xp6(2),t.hij("",e.value," ")}}function D(i,c){if(1&i&&(t.ynx(0),t.TgZ(1,"span",2),t._uU(2,"Charts"),t.qZA(),t.TgZ(3,"div",11)(4,"h3"),t._uU(5,"Price/Amount"),t.qZA(),t._UZ(6,"div",12),t.qZA(),t.TgZ(7,"div",11)(8,"h3"),t._uU(9,"Liquidity"),t.qZA(),t._UZ(10,"div",13),t.qZA(),t.BQk()),2&i){const e=t.oxw();t.xp6(6),t.Q6J("options",e.chartOption1)("loading",!e.pair),t.xp6(4),t.Q6J("options",e.chartOption2)("loading",!e.pair)}}function A(i,c){1&i&&(t.TgZ(0,"div",14),t._uU(1,"Created"),t.qZA())}function U(i,c){1&i&&(t.TgZ(0,"div",15),t._uU(1,"Executed"),t.qZA())}function E(i,c){1&i&&(t.TgZ(0,"div",16),t._uU(1,"Abort"),t.qZA())}function S(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"div",17),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.excuteProposal())}),t._uU(1,"Executable"),t.qZA()}}let T=(()=>{class i{constructor(e,a){this.dialogRef=e,this.web3Service=a,this.proposalData$=new x.X({label:"",value:""}),this.chartOption1={tooltip:{trigger:"axis",position:function(n){return{top:"10%",right:"5%"}},valueFormatter:n=>parseFloat(n).toFixed(4)+" "+this.pair?.token.symbol},grid:{left:"5%",right:"5%",bottom:"15%",top:"5%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,min:0,axisLabel:{show:!1},axisTick:{show:!1},data:[]},yAxis:{type:"value",min:0,axisLabel:{show:!1},axisTick:{show:!1},axisLine:{show:!0},splitLine:{show:!1}},legend:{},dataZoom:[{type:"inside",start:0,end:100},{type:"slider",show:!0,bottom:0,height:20,start:0,end:100,backgroundColor:"rgba(255,255,255,0.1)",fillerColor:"rgba(255,255,255,0)",borderColor:"#FFEAF5",borderRadius:4,brushStyle:{color:"rgba(255,255,255,0)"},selectedDataBackground:{lineStyle:{color:"#ffb6db"},areaStyle:{color:new f.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#ffb6db"},{offset:1,color:"#f9d4af"}])}},handleSize:15,brushSelect:!1,dataBackground:{lineStyle:{color:"#fff5f0"},areaStyle:{color:new f.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#fff5f0"},{offset:1,color:"#ffffff"}])}}}],series:[{name:"prev Price",type:"line",symbol:"none",itemStyle:{color:"#ffb6db"},areaStyle:{color:new f.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(255,182,219,0.3)"},{offset:.8,color:"rgba(249,212,175,0.1)"},{offset:1,color:"rgba(255,255,255,0)"}])},data:[]},{name:"new Price",type:"line",symbol:"none",itemStyle:{color:"#00B6FF"},areaStyle:{color:new f.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#00FFF1"},{offset:.8,color:"rgba(180,233,255,0.1)"},{offset:1,color:"rgba(255,255,255,0)"}])},data:[]}]},this.chartOption2={tooltip:{trigger:"axis",position:function(n){return{top:"10%",right:"5%"}},valueFormatter:n=>parseFloat(n).toFixed(4)+" "},grid:{left:"5%",right:"5%",bottom:"2%",top:"5%",containLabel:!0},xAxis:{type:"category",min:0,boundaryGap:!1,axisLabel:{show:!0},axisTick:{show:!0}},yAxis:{type:"value",axisLabel:{show:!1},axisTick:{show:!1},axisLine:{show:!0},splitLine:{show:!1}},legend:{},series:[{name:"prev Liquidity",type:"line",symbol:"none",itemStyle:{color:"#ffb6db"},areaStyle:{color:new f.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"rgba(255,182,219,0.3)"},{offset:1,color:"rgba(249,212,175,0.8)"}])},data:[]},{name:"new Liquidity",type:"line",symbol:"none",itemStyle:{color:"#00B6FF"},areaStyle:{color:new f.graphic.LinearGradient(0,0,0,1,[{offset:0,color:"#00FFF1"},{offset:1,color:"rgba(180,233,255,0.8)"}])},data:[]}]}}ngOnInit(){this.buildProposalData()}parseInt(e){return parseInt(e)}isExecutable(e){return 1e3*(parseInt(e.startTime)+parseInt(e.delay))<=(new Date).getTime()}getStatus(e){const a=this.isExecutable(e);return 0==e.status?a?3:0:e.status}buildProposalData(){switch(this.proposal.type){case 0:const e=l.O$.from(JSON.parse(this.proposal.data).newMinSqrtPrice).pow(2).div(r.yb).toString();this.getPriceRangeWithMinPrice(e).then(({maxPrice:n,newLiquidity:p})=>{this.proposalData$.next({label:"New Price Range",value:`${(0,o.formatUnits)(e,"18")} - ${(0,o.formatUnits)(n,"18")}`}),this.calcCurrentPriceData(),this.calcNewPriceData(p,n,e)});break;case 1:const a=l.O$.from(JSON.parse(this.proposal.data).newMaxSqrtPrice).pow(2).div(r.yb).toString();this.getPriceRangeWithMaxPrice(a).then(({minPrice:n,newLiquidity:p})=>{this.proposalData$.next({label:"New Price Range",value:`${(0,o.formatUnits)(n,"18")} - ${(0,o.formatUnits)(a,"18")}`}),this.calcCurrentPriceData(),this.calcNewPriceData(p,a,n)});break;case 2:this.proposalData$.next({label:"New Royalty Rayio :",value:`${(0,o.formatUnits)(JSON.parse(this.proposal.data).newRoyaltyRatio,"16")} %`});break;case 3:this.proposalData$.next({label:"New Withdraw Royalty Amount",value:`${(0,o.formatUnits)(JSON.parse(this.proposal.data).newWithdrawRoyaltyAmount,"18")} ${this.pair.token.symbol}`});break;case 4:this.proposalData$.next({label:"New Royalty Reward Ratio",value:`${(0,o.formatUnits)(JSON.parse(this.proposal.data).newRoyaltyRewardRatio,"16")} %`})}}getPriceRangeWithMaxPrice(e){return this.web3Service.invokeContract("IntswapV1Pair","getNewPriceRangeWithMaxSqrtPrice",[(0,r._b)(l.O$.from(e).mul(r.yb)).toString()],this.pair.address).then(a=>({minPrice:l.O$.from(a[1]).pow(2).div(r.yb).toString(),newLiquidity:a[0]}))}getPriceRangeWithMinPrice(e){return this.web3Service.invokeContract("IntswapV1Pair","getNewPriceRangeWithMinSqrtPrice",[(0,r._b)(l.O$.from(e).mul(r.yb)).toString()],this.pair.address).then(a=>({maxPrice:l.O$.from(a[1]).pow(2).div(r.yb).toString(),newLiquidity:a[0]}))}excuteProposal(){this.dialogRef.close(this.proposal)}calcCurrentPriceData(){if(this.pair){const e=new Array(2*parseInt((0,o.formatUnits)(this.pair.nftAmount,"18"))).fill(0).map((p,h)=>this.pair?(0,o.formatUnits)(l.O$.from(this.pair.liquidity).pow(2).mul(r.yb).div(l.O$.from(h+1).mul(r.yb).add(l.O$.from(this.pair.liquidity).mul(r.yb).div((0,r._b)(l.O$.from(this.pair.maxPrice).mul(r.yb)))).pow(2)).toString(),"18"):"0.0000");this.chartOption1=(0,g.cloneDeep)(this.chartOption1),this.chartOption1.xAxis.data=new Array(2*parseInt((0,o.formatUnits)(this.pair?.nftAmount||0,"18"))).fill(0).map((p,h)=>h+1),this.chartOption1.series[0].data=e,this.chartOption1.series[0].markPoint={symbol:"circle",symbolSize:6,data:[{coord:[parseInt((0,o.formatUnits)(this.pair.nftAmount,"18"))+"",(0,o.formatUnits)(this.pair.price,"18")]}]},this.chartOption1.series[0].markLine={lineStyle:{color:"rgba(255,182,219,0.8)"},symbol:["none","none"],data:[{yAxis:(0,o.formatUnits)(this.pair.price,"18")}],label:{color:"rgba(255,182,219,0.8)",position:"start"}},this.chartOption2=(0,g.cloneDeep)(this.chartOption2);const a=(0,o.formatUnits)(this.pair.maxPrice,"18"),n=(0,o.formatUnits)(this.pair.minPrice,"18");this.chartOption2.xAxis.data=[n,a],this.chartOption2.series[0].data=[[n,(0,o.formatUnits)(this.pair.liquidity,"18")],[a,(0,o.formatUnits)(this.pair.liquidity,"18")]]}}calcNewPriceData(e,a,n){if(this.pair){const p=new Array(2*parseInt((0,o.formatUnits)(this.pair.nftAmount,"18"))).fill(0).map((v,u)=>this.pair?(0,o.formatUnits)(l.O$.from(e).pow(2).mul(r.yb).div(l.O$.from(u+1).mul(r.yb).add(l.O$.from(e).mul(r.yb).div((0,r._b)(l.O$.from(a).mul(r.yb)))).pow(2)).toString(),"18"):"0.0000");this.chartOption1=(0,g.cloneDeep)(this.chartOption1),this.chartOption1.series[1].data=p,this.chartOption2=(0,g.cloneDeep)(this.chartOption2);const h=(0,o.formatUnits)(this.pair.maxPrice,"18"),R=(0,o.formatUnits)(this.pair.minPrice,"18"),P=(0,o.formatUnits)(a,"18"),w=(0,o.formatUnits)(n,"18");this.chartOption2.xAxis.data=[w,P,h,R].sort((v,u)=>parseFloat(v)-parseFloat(u)),this.chartOption2.series[1].data=[[w,(0,o.formatUnits)(e,"18")],[P,(0,o.formatUnits)(e,"18")]]}}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(_.so),t.Y36(M.U))},i.\u0275cmp=t.Xpm({type:i,selectors:[["app-proposal-dialog"]],decls:31,vars:20,consts:[[1,"dialog-wrapper"],[1,"review-step"],[2,"color","#fff","background","rgb(255, 211, 227)","margin-bottom","0","font-weight","bolder","padding","0 12px","grid-column-start","span 4","width","100%"],[1,"review-label"],[1,"review-value"],[4,"ngIf"],[1,"status-wrapper",3,"ngSwitch"],["class","status created",4,"ngSwitchCase"],["class","status executed",4,"ngSwitchCase"],["class","status abort",4,"ngSwitchCase"],["class","status executable",3,"click",4,"ngSwitchCase"],[1,"chart"],["echarts","",1,"price-volume-chart",3,"options","loading"],["echarts","",1,"liquidity-price-chart",3,"options","loading"],[1,"status","created"],[1,"status","executed"],[1,"status","abort"],[1,"status","executable",3,"click"]],template:function(e,a){1&e&&(t.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),t._uU(3,"PROPOSAL"),t.qZA(),t.TgZ(4,"h2"),t._uU(5),t.qZA(),t.TgZ(6,"span",2),t._uU(7,"Detail"),t.qZA(),t.TgZ(8,"div",3),t._uU(9,"Application Date :"),t.qZA(),t.TgZ(10,"div",4),t._uU(11),t.ALo(12,"date"),t.qZA(),t.TgZ(13,"div",3),t._uU(14,"Effective Date :"),t.qZA(),t.TgZ(15,"div",4),t._uU(16),t.ALo(17,"date"),t.qZA(),t.YNc(18,C,5,2,"ng-container",5),t.ALo(19,"async"),t.TgZ(20,"div",3),t._uU(21,"Description :"),t.qZA(),t.TgZ(22,"div",4)(23,"p"),t._uU(24),t.qZA()(),t.YNc(25,D,11,4,"ng-container",5),t.qZA(),t.TgZ(26,"div",6),t.YNc(27,A,2,0,"div",7),t.YNc(28,U,2,0,"div",8),t.YNc(29,E,2,0,"div",9),t.YNc(30,S,2,0,"div",10),t.qZA()()),2&e&&(t.xp6(5),t.AsE("Request Readjust ",a.pair.collection.symbol,"&",a.pair.token.symbol," Price Range"),t.xp6(6),t.Oqu(t.xi3(12,12,1e3*a.parseInt(a.proposal.startTime),"y-M-dd HH:mm:ss")),t.xp6(5),t.hij(" ",t.xi3(17,15,1e3*(a.parseInt(a.proposal.startTime)+a.parseInt(a.proposal.delay)),"y-M-dd HH:mm:ss")," "),t.xp6(2),t.Q6J("ngIf",t.lcZ(19,18,a.proposalData$)),t.xp6(6),t.Oqu(a.proposal.desc||"no description."),t.xp6(1),t.Q6J("ngIf",0==a.proposal.type||1==a.proposal.type),t.xp6(1),t.Q6J("ngSwitch",a.getStatus(a.proposal)),t.xp6(1),t.Q6J("ngSwitchCase",0),t.xp6(1),t.Q6J("ngSwitchCase",1),t.xp6(1),t.Q6J("ngSwitchCase",2),t.xp6(1),t.Q6J("ngSwitchCase",3))},dependencies:[d.O5,d.RF,d.n9,b._w,d.Ov,d.uU],styles:[".dialog-wrapper[_ngcontent-%COMP%]{width:30vw;height:80vh;overflow:hidden;padding:2rem 1rem 3rem 2rem;background:linear-gradient(135deg,#feedff 0%,#fff 10%,#fff 90%,#fff4e6 100%);border-radius:16px;border:1px solid rgba(228,178,201,.24);box-sizing:border-box;position:relative}.review-step[_ngcontent-%COMP%]{position:relative;width:100%;height:100%;padding-right:.6rem;overflow-y:scroll;overflow-x:hidden;box-sizing:border-box;display:grid;grid-template-columns:auto 1fr 1fr 1fr;justify-items:center;align-items:center;row-gap:12px;column-gap:12px}.review-step[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{grid-column-start:span 4;text-align:left;font-size:24px;font-weight:bolder;justify-self:start}.review-step[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{grid-column-start:span 4;text-align:left;font-weight:bolder;justify-self:start}.review-step[_ngcontent-%COMP%]   .review-label[_ngcontent-%COMP%]{width:100%;text-align:left;font-weight:700;align-self:start}.review-step[_ngcontent-%COMP%]   .review-value[_ngcontent-%COMP%]{grid-column-start:span 3;justify-self:start;align-self:start;width:80%;word-break:break-word}.review-step[_ngcontent-%COMP%]   .step-btn[_ngcontent-%COMP%]{grid-column-start:span 2}.review-step[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]{grid-column-start:span 4;padding:0 0 12px;width:100%}.review-step[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]   .liquidity-price-chart[_ngcontent-%COMP%], .review-step[_ngcontent-%COMP%]   .chart[_ngcontent-%COMP%]   .price-volume-chart[_ngcontent-%COMP%]{width:100%;height:30vh}.status-wrapper[_ngcontent-%COMP%]{position:absolute;bottom:.5rem;width:calc(30vw - 4rem);display:flex;flex-direction:row;justify-content:center;align-items:center}.status[_ngcontent-%COMP%]{color:#fff;font-weight:700;padding:0 12px;border-radius:16px;font-size:18px;display:flex;flex-direction:row;justify-content:center;align-items:center}.executable[_ngcontent-%COMP%]{background:rgb(136,85,255);cursor:pointer}.created[_ngcontent-%COMP%]{background:rgb(78,230,202)}.executed[_ngcontent-%COMP%]{background:rgb(94,219,236)}.abort[_ngcontent-%COMP%]{background:rgb(255,105,105)}"]}),i})(),Z=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[d.ez,O.Ps,y.ot,_.Is,b.Ns.forChild()]}),i})()}}]);