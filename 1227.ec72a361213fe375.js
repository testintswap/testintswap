"use strict";(self.webpackChunkintswap_frontend=self.webpackChunkintswap_frontend||[]).push([[1227],{11227:(at,y,a)=>{a.r(y),a.d(y,{LpStakingPoolsModule:()=>it});var _=a(88692),h=a(7976),P=a(8239),s=a(2024),T=a(92673),C=a(54121),m=a(27969),f=a(61528),M=a(84967),S=a(42147),x=a(15696),k=a(66393),A=a(84945),U=a(62686),w=a(41781),t=a(64537),I=a(19376),B=a(96195),N=a(39869),L=a(83331),O=a(50132);function J(o,e){1&o&&(t.TgZ(0,"mat-icon",13),t._uU(1," south"),t.qZA())}function Y(o,e){1&o&&(t.TgZ(0,"mat-icon",13),t._uU(1," north"),t.qZA())}function Q(o,e){if(1&o&&(t.ynx(0),t.YNc(1,J,2,0,"mat-icon",12),t.YNc(2,Y,2,0,"mat-icon",12),t.BQk()),2&o){const n=t.oxw().ngIf;t.xp6(1),t.Q6J("ngIf",-1==n.sortBy.sortDirection),t.xp6(1),t.Q6J("ngIf",1==n.sortBy.sortDirection)}}function D(o,e){1&o&&(t.TgZ(0,"mat-icon",13),t._uU(1," south"),t.qZA())}function F(o,e){1&o&&(t.TgZ(0,"mat-icon",13),t._uU(1," north"),t.qZA())}function E(o,e){if(1&o&&(t.ynx(0),t.YNc(1,D,2,0,"mat-icon",12),t.YNc(2,F,2,0,"mat-icon",12),t.BQk()),2&o){const n=t.oxw().ngIf;t.xp6(1),t.Q6J("ngIf",-1==n.sortBy.sortDirection),t.xp6(1),t.Q6J("ngIf",1==n.sortBy.sortDirection)}}function z(o,e){1&o&&(t.TgZ(0,"div",14),t._uU(1,"loading..."),t.qZA())}function R(o,e){1&o&&(t.TgZ(0,"div",14),t._uU(1,"No Data."),t.qZA())}function b(o,e){1&o&&(t.TgZ(0,"mat-icon",21),t._uU(1," emoji_events"),t.qZA())}function j(o,e){if(1&o&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&o){const n=e.ngIf;t.xp6(1),t.AsE(" ",n.name," : ",n.apy," % ")}}function G(o,e){1&o&&t._uU(0," loading Item ... ")}function q(o,e){if(1&o&&(t.TgZ(0,"div"),t.YNc(1,j,2,2,"div",23),t.ALo(2,"async"),t.YNc(3,G,1,0,"ng-template",null,26,t.W1O),t.qZA()),2&o){const n=e.$implicit,i=t.MAs(4);t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,n))("ngIfElse",i)}}function H(o,e){if(1&o&&(t.ynx(0),t.YNc(1,q,5,4,"div",25),t.BQk()),2&o){const n=e.ngIf;t.xp6(1),t.Q6J("ngForOf",n)}}function W(o,e){1&o&&t._uU(0," loading ")}function K(o,e){if(1&o&&(t.TgZ(0,"div",22),t.YNc(1,H,2,1,"ng-container",23),t.ALo(2,"async"),t.YNc(3,W,1,0,"ng-template",null,24,t.W1O),t.qZA()),2&o){const n=t.MAs(4),i=t.oxw().$implicit;t.xp6(1),t.Q6J("ngIf",t.lcZ(2,2,i.strategyApys$))("ngIfElse",n)}}const V=function(o){return["/","app","lp-staking-pool",o]};function X(o,e){if(1&o&&(t.TgZ(0,"div",15)(1,"div",4),t._uU(2),t.YNc(3,b,2,0,"mat-icon",16),t.qZA(),t.TgZ(4,"div",17),t._uU(5),t.ALo(6,"number"),t.ALo(7,"async"),t.qZA(),t.TgZ(8,"div",18),t._uU(9),t.ALo(10,"number"),t.ALo(11,"async"),t.TgZ(12,"mat-icon",19),t._uU(13,"help "),t.qZA()(),t.TgZ(14,"div",8),t._uU(15),t.qZA(),t.TgZ(16,"div",9),t._uU(17),t.ALo(18,"async"),t.qZA(),t.YNc(19,K,5,4,"ng-template",null,20,t.W1O),t.qZA()),2&o){const n=e.$implicit,i=t.MAs(20),c=t.oxw(2);t.Q6J("routerLink",t.VKq(21,V,n.pairAddress)),t.xp6(2),t.hij("",n.pairName," "),t.xp6(1),t.Q6J("ngIf",c.isTestnetPair(n.pairAddress)),t.xp6(2),t.hij("$ ",t.xi3(6,9,n.tvl||t.lcZ(7,12,n.tvl$)||0,"1.2-2"),""),t.xp6(4),t.hij("",t.xi3(10,14,n.totalApy||t.lcZ(11,17,n.totalApy$)||0,"1.2-2")," % "),t.xp6(3),t.Q6J("nzPopoverArrowPointAtCenter",!0)("nzPopoverContent",i),t.xp6(3),t.hij("",n.stakedRatio," %"),t.xp6(2),t.hij("$ ",t.lcZ(18,19,n.userStaked$),"")}}function tt(o,e){if(1&o){const n=t.EpF();t.TgZ(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4),t._uU(4,"NAME"),t.qZA(),t.TgZ(5,"div",5),t.NdJ("click",function(){const p=t.CHM(n).ngIf,l=t.oxw();return t.KtG(l.changeSortDirection("tvl",p.sortBy))}),t._uU(6,"TVL "),t.YNc(7,Q,3,2,"ng-container",6),t.qZA(),t.TgZ(8,"div",7),t.NdJ("click",function(){const p=t.CHM(n).ngIf,l=t.oxw();return t.KtG(l.changeSortDirection("apy",p.sortBy))}),t._uU(9,"Total APY "),t.YNc(10,E,3,2,"ng-container",6),t.qZA(),t.TgZ(11,"div",8),t._uU(12,"Total Staked Ratio"),t.qZA(),t.TgZ(13,"div",9),t._uU(14,"Your Staked"),t.qZA()(),t.YNc(15,z,2,0,"div",10),t.YNc(16,R,2,0,"div",10),t.YNc(17,X,21,23,"div",11),t.qZA()()}if(2&o){const n=e.ngIf;t.xp6(7),t.Q6J("ngIf",n.sortBy&&"tvl"==n.sortBy.sortBy),t.xp6(3),t.Q6J("ngIf",n.sortBy&&"apy"==n.sortBy.sortBy),t.xp6(5),t.Q6J("ngIf",!n.lpStakingPoolList),t.xp6(1),t.Q6J("ngIf",!!n.lpStakingPoolList&&0==n.lpStakingPoolList.length),t.xp6(1),t.Q6J("ngForOf",n.lpStakingPoolList)}}const ot=function(o,e){return{lpStakingPoolList:o,sortBy:e}},nt=[{path:"",component:(()=>{class o{constructor(n,i,c){var p=this;this.cacheService=n,this.web3Service=i,this.graphqlService=c,this.sortBy$=new C.X({sortBy:"tvl",sortDirection:-1}),this.showOnlyUserStaked$=new C.X(!1),this.lpStakingPoolList$=this.cacheService.pairList$.pipe((0,m.U)(l=>l.map(r=>{const g=s.O$.from(r.lpStakingPool.totalStakingAmount).mul(s.O$.from("10000")).div(s.O$.from(r.liquidity)).toNumber()/100,u=this.cacheService.ethPrice$.pipe((0,m.U)(d=>s.O$.from(d).mul(s.O$.from(r.tvl)).mul(s.O$.from(parseInt(100*g+""))).div(s.O$.from("10").pow(30)).toString())),Z=u.pipe((0,f.w)(function(){var d=(0,P.Z)(function*(v){return yield p.getApy0fStrategies(r,v)});return function(v){return d.apply(this,arguments)}}())),rt=Z.pipe((0,f.w)(d=>(0,M.D)(d))).pipe((0,m.U)(d=>this.sumApy(d)),(0,S.x)((d,v)=>d==v)),$=r.lpStakingPool.userStaking.length>0&&s.O$.from(r.lpStakingPool.userStaking[0].amount).gt(s.O$.from("0"));return{pairAddress:r.address,pairName:r.collection.symbol+" - "+r.token.symbol,totalApy$:rt,stakedRatio:g,tvl$:u,strategyApys$:Z,isUserStaked:$,userStaked$:u.pipe((0,m.U)(d=>$?s.O$.from(r.lpStakingPool.userStaking[0].amount).mul(s.O$.from(d)).div(s.O$.from(r.lpStakingPool.totalStakingAmount)).toString():"0"))}}))),this.filterLpStakingPoolList$=this.showOnlyUserStaked$.pipe((0,f.w)(l=>this.lpStakingPoolList$.pipe((0,m.U)(r=>r.filter(g=>!l||g.isUserStaked))))),this.sortLpStakingPoolList$=this.filterLpStakingPoolList$.pipe((0,f.w)(l=>this.sortList(l)))}ngOnInit(){}sortList(n){if(n){const i=n.map(c=>c.totalApy$.pipe((0,m.U)(p=>({...c,totalApy:p}))).pipe((0,f.w)(p=>p.tvl$.pipe((0,m.U)(l=>({...p,tvl:l}))))));return this.sortBy$.pipe((0,f.w)(({sortBy:c,sortDirection:p})=>{switch(c){case"apy":return(0,x.a)(i).pipe((0,m.U)(l=>l.sort((r,g)=>p*(r.totalApy-g.totalApy))));case"tvl":return(0,x.a)(i).pipe((0,m.U)(l=>l.sort((r,g)=>p*(parseFloat(r.tvl)>parseFloat(g.tvl)?1:-1))))}}))}return(0,k.D)([])}sumApy(n){let i=0;for(let c=0;c<n.length;c++)i+=n[c].apy;return i}changeSortDirection(n,i){i&&this.sortBy$.next({sortBy:n,sortDirection:n==i.sortBy?-1*i.sortDirection:-1})}getGlobalStrategies(){return this.cacheService.getGlobalStrategies()}getApy0fStrategies(n,i){var c=this;return(0,P.Z)(function*(){return[...yield c.getGlobalStrategies(),...n.lpStakingPool.incentiveStrategyList].map(p=>{if(p.status){const l=c.getStrategyRewardRate(n.address,p.address);return l&&s.O$.from(i).gt(s.O$.from(0))?l.pipe((0,m.U)(r=>({name:p.name,apy:s.O$.from(r).mul(s.O$.from("10000")).div(w.yb).div(s.O$.from(i)).toNumber()/100})),(0,S.x)((r,g)=>r==g)):(0,A.of)({name:p.name,apy:0})}return(0,A.of)({name:p.name,apy:0})})})()}getStrategyRewardRate(n,i){var c=this;return(0,k.D)(this.web3Service.invokeContract("IIntswapV1IncentiveStrategy","estimatedOneYearRewards",[n],i)).pipe((0,f.w)(function(){var p=(0,P.Z)(function*(l){const r=l[0];if(r==U.je)return"0";const g=l[1],u=(0,T.parseUnits)(yield c.cacheService.fetchRewardTokenPrice(r),"2");return s.O$.from(g).mul(u).div(s.O$.from("100")).toString()});return function(l){return p.apply(this,arguments)}}()))}isTestnetPair(n){return["0x9FbAC0d7235809caC1fE0535096f4d45A2CBBe12","0xEcC79aF1ab1923a2DFEFcE705228C86029567129","0xa48649E328158d5867072c54d725C218550A1009","0x7C2917E9cC0635E23A4ACd55D0A2C0cCfE19E029","0x36aA5CD15aa12D953C973A792D4837aF61d65f24"].map(i=>i.toLowerCase()).includes(n.toLowerCase())}}return o.\u0275fac=function(n){return new(n||o)(t.Y36(I.Q),t.Y36(B.U),t.Y36(N.J))},o.\u0275cmp=t.Xpm({type:o,selectors:[["app-lp-staking-pools"]],decls:3,vars:8,consts:[["class","lp-pools-wrapper",4,"ngIf"],[1,"lp-pools-wrapper"],[1,"lp-pools-list"],[1,"lp-pool-header"],[1,"lp-pool-name"],[1,"lp-pool-tvl",2,"cursor","pointer",3,"click"],[4,"ngIf"],[1,"lp-pool-total-apy",2,"cursor","pointer",3,"click"],[1,"lp-pool-staked-ratio"],[1,"lp-pool-user-staked"],["class","lp-pool-loading",4,"ngIf"],["class","lp-pool-item",3,"routerLink",4,"ngFor","ngForOf"],["color","primary",4,"ngIf"],["color","primary"],[1,"lp-pool-loading"],[1,"lp-pool-item",3,"routerLink"],["style","font-size: 14px;color: gold;height: 14px;line-height: 14px;animation: changeColor 1.2s infinite linear;",4,"ngIf"],[1,"lp-pool-tvl"],[1,"lp-pool-total-apy"],["color","primary","nz-popover","","nzPopoverPlacement","rightTop",3,"nzPopoverArrowPointAtCenter","nzPopoverContent"],["apyDetail",""],[2,"font-size","14px","color","gold","height","14px","line-height","14px","animation","changeColor 1.2s infinite linear"],[2,"min-height","10vh","min-width","15vw"],[4,"ngIf","ngIfElse"],["loading",""],[4,"ngFor","ngForOf"],["loadingItem",""]],template:function(n,i){1&n&&(t.YNc(0,tt,18,5,"div",0),t.ALo(1,"async"),t.ALo(2,"async")),2&n&&t.Q6J("ngIf",t.WLB(5,ot,t.lcZ(1,1,i.sortLpStakingPoolList$),t.lcZ(2,3,i.sortBy$)))},dependencies:[_.sg,_.O5,h.rH,L.Hw,O.lU,_.Ov,_.JJ],styles:[".lp-pools-wrapper[_ngcontent-%COMP%]{width:80vw;min-height:40vh;border-radius:16px;background:#fff;margin:1rem auto;padding:12px}.lp-pools-list[_ngcontent-%COMP%]{width:100%}.lp-pool-loading[_ngcontent-%COMP%]{width:100%;margin-bottom:4px;height:40px;display:flex;align-items:center;justify-content:center}.lp-pool-header[_ngcontent-%COMP%], .lp-pool-item[_ngcontent-%COMP%]{width:100%;margin-bottom:4px;height:40px;display:grid;grid-template-columns:1fr 1fr 1fr 1fr 1fr;font-weight:700}.lp-pool-header[_ngcontent-%COMP%]   .lp-pool-name[_ngcontent-%COMP%], .lp-pool-header[_ngcontent-%COMP%]   .lp-pool-total-apy[_ngcontent-%COMP%], .lp-pool-header[_ngcontent-%COMP%]   .lp-pool-staked-ratio[_ngcontent-%COMP%], .lp-pool-header[_ngcontent-%COMP%]   .lp-pool-user-staked[_ngcontent-%COMP%], .lp-pool-header[_ngcontent-%COMP%]   .lp-pool-tvl[_ngcontent-%COMP%], .lp-pool-item[_ngcontent-%COMP%]   .lp-pool-name[_ngcontent-%COMP%], .lp-pool-item[_ngcontent-%COMP%]   .lp-pool-total-apy[_ngcontent-%COMP%], .lp-pool-item[_ngcontent-%COMP%]   .lp-pool-staked-ratio[_ngcontent-%COMP%], .lp-pool-item[_ngcontent-%COMP%]   .lp-pool-user-staked[_ngcontent-%COMP%], .lp-pool-item[_ngcontent-%COMP%]   .lp-pool-tvl[_ngcontent-%COMP%]{padding:0 12px;width:100%;height:100%;display:flex;justify-content:center;align-items:center}.lp-pool-header[_ngcontent-%COMP%]{font-weight:bolder;height:48px;font-size:18px;border-radius:4px;background:rgb(255,241,248)}.lp-pool-item[_ngcontent-%COMP%]{border-radius:4px;border:1px solid rgba(255,216,237,.4);cursor:pointer}.lp-pool-item[_ngcontent-%COMP%]:hover{background:rgb(249,241,255)}.lp-pool-item[_ngcontent-%COMP%]   .lp-pool-total-apy[_ngcontent-%COMP%]   mat-icon[_ngcontent-%COMP%]{margin-left:12px;height:18px;width:18px;font-size:18px;cursor:pointer}@keyframes changeColor{0%{color:gold}25%{color:#0ff}50%{color:#0f2}75%{color:#fffb00}to{color:gold}}"]}),o})()}];let et=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[h.Bz.forChild(nt),h.Bz]}),o})(),it=(()=>{class o{}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[_.ez,et,L.Ps,O.$6]}),o})()}}]);